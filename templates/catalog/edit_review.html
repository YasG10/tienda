{% extends "base.html" %}
{% block title %}Editar Reseña - {{ product.name }}{% endblock %}

{% block content %}
<div class="max-w-3xl mx-auto py-12 px-4">
    <div class="mb-8">
        <a href="{% url 'catalog:product_detail' product.id %}" class="text-indigo-600 hover:text-indigo-700 font-medium flex items-center gap-2 mb-4">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path></svg>
            Volver al producto
        </a>
        <h1 class="text-4xl font-bold text-slate-900">Editar tu Reseña</h1>
        <p class="text-slate-600 mt-2">Actualiza tu opinión sobre {{ product.name }}</p>
    </div>

    <div class="bg-white rounded-2xl shadow-lg p-8 border border-slate-200">
        <!-- Producto Preview -->
        <div class="flex items-center gap-4 p-4 bg-slate-50 rounded-xl mb-8">
            {% if product.image %}
                <img src="{{ product.image.url }}" alt="{{ product.name }}" class="w-20 h-20 object-cover rounded-lg">
            {% else %}
                <div class="w-20 h-20 bg-slate-200 rounded-lg"></div>
            {% endif %}
            <div>
                <h3 class="font-bold text-slate-900">{{ product.name }}</h3>
                <p class="text-sm text-slate-600">{{ product.category.name }}</p>
            </div>
        </div>

        <!-- Formulario -->
        <form method="post" enctype="multipart/form-data" class="space-y-6">
            {% csrf_token %}
            
            {% if form.errors %}
            <div class="bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg">
                <p class="font-semibold">Por favor corrige los siguientes errores:</p>
                {{ form.errors }}
            </div>
            {% endif %}

            <!-- Rating -->
            <div>
                <label class="block text-sm font-bold text-slate-700 mb-3">Calificación *</label>
                <div class="flex items-center gap-2 rating-container">
                    <label class="rating-label cursor-pointer transition hover:scale-110">
                        <input type="radio" name="rating" value="1" class="hidden rating-input" {% if review.rating == 1 %}checked{% endif %} required>
                        <div class="flex items-center gap-1 px-4 py-2 border-2 border-slate-300 rounded-lg hover:border-amber-400 transition">
                            <span class="text-2xl">⭐</span>
                        </div>
                    </label>
                    <label class="rating-label cursor-pointer transition hover:scale-110">
                        <input type="radio" name="rating" value="2" class="hidden rating-input" {% if review.rating == 2 %}checked{% endif %} required>
                        <div class="flex items-center gap-1 px-4 py-2 border-2 border-slate-300 rounded-lg hover:border-amber-400 transition">
                            <span class="text-2xl">⭐⭐</span>
                        </div>
                    </label>
                    <label class="rating-label cursor-pointer transition hover:scale-110">
                        <input type="radio" name="rating" value="3" class="hidden rating-input" {% if review.rating == 3 %}checked{% endif %} required>
                        <div class="flex items-center gap-1 px-4 py-2 border-2 border-slate-300 rounded-lg hover:border-amber-400 transition">
                            <span class="text-2xl">⭐⭐⭐</span>
                        </div>
                    </label>
                    <label class="rating-label cursor-pointer transition hover:scale-110">
                        <input type="radio" name="rating" value="4" class="hidden rating-input" {% if review.rating == 4 %}checked{% endif %} required>
                        <div class="flex items-center gap-1 px-4 py-2 border-2 border-slate-300 rounded-lg hover:border-amber-400 transition">
                            <span class="text-2xl">⭐⭐⭐⭐</span>
                        </div>
                    </label>
                    <label class="rating-label cursor-pointer transition hover:scale-110">
                        <input type="radio" name="rating" value="5" class="hidden rating-input" {% if review.rating == 5 %}checked{% endif %} required>
                        <div class="flex items-center gap-1 px-4 py-2 border-2 border-slate-300 rounded-lg hover:border-amber-400 transition">
                            <span class="text-2xl">⭐⭐⭐⭐⭐</span>
                        </div>
                    </label>
                </div>
                <p class="text-xs text-slate-500 mt-2">Selecciona cuántas estrellas le das al producto</p>
            </div>

            <!-- Título -->
            <div>
                <label for="{{ form.title.id_for_label }}" class="block text-sm font-bold text-slate-700 mb-2">{{ form.title.label }}</label>
                {{ form.title }}
            </div>

            <!-- Comentario -->
            <div>
                <label for="{{ form.comment.id_for_label }}" class="block text-sm font-bold text-slate-700 mb-2">{{ form.comment.label }}</label>
                {{ form.comment }}
            </div>

            <!-- Imagen -->
            <div>
                <label for="{{ form.image.id_for_label }}" class="block text-sm font-bold text-slate-700 mb-2">{{ form.image.label }}</label>
                {% if review.image %}
                <div class="mb-3">
                    <img src="{{ review.image.url }}" alt="Foto actual" class="w-32 h-32 object-cover rounded-lg border-2 border-slate-200">
                    <p class="text-xs text-slate-500 mt-1">Imagen actual</p>
                </div>
                {% endif %}
                {{ form.image }}
                <p class="text-xs text-slate-500 mt-1">Deja en blanco para mantener la imagen actual</p>
            </div>

            <!-- Botones -->
            <div class="flex gap-4 pt-4">
                <button type="submit" class="flex-1 bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-6 rounded-xl transition">
                    Actualizar Reseña
                </button>
                <a href="{% url 'catalog:product_detail' product.id %}" class="px-6 py-3 border-2 border-slate-300 text-slate-700 font-bold rounded-xl hover:bg-slate-50 transition">
                    Cancelar
                </a>
            </div>
        </form>
    </div>
</div>

<style>
    .rating-input:checked + div {
        border-color: rgb(251, 191, 36);
        background-color: rgb(254, 243, 199);
    }
</style>
{% endblock %}
